<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.xier.sesame.attence.domain.NewSwitchSetting">

    <resultMap id="NewSwitchSettingResultMap" type="com.xier.sesame.attence.domain.NewSwitchSetting">
        <result column="switch_setting_id" property="switchSettingId" />
        <result column="org_id" property="orgId" />
        <result column="group_id" property="groupId" />
        <result column="group_code" property="groupCode" />
        <result column="attence_switch" property="attenceSwitch" />
        <result column="stanger_switch" property="stangerSwitch" />
        <result column="open_week_days" property="openWeekDays" />
        <result column="day_begin_time" property="dayBeginTime" />
        <result column="day_end_time" property="dayEndTime" />
        <result column="gmt_create" property="gmtCreate" />
        <result column="gmt_modify" property="gmtModify" />
    </resultMap>

    <insert id="addSwitchSetting" parameterType="com.xier.sesame.attence.domain.NewSwitchSetting">

        insert into new_attence_switch_setting(
        switch_setting_id,
        org_id,
        group_id,
        group_code,
        attence_switch,
        stanger_switch,
        open_week_days,
        day_begin_time,
        day_end_time,
        gmt_create,
        gmt_modify
        )
        values (
        #{switchSettingId},
        #{orgId},
        #{groupId},
        #{groupCode},
        #{attenceSwitch},
        #{stangerSwitch},
        #{openWeekDays},
        #{dayBeginTime},
        #{dayEndTime},
        now(3),
        now(3)
        )
    </insert>

    <update id="updateSwitchSetting" parameterType="com.xier.sesame.attence.domain.NewSwitchSetting">
        update new_attence_switch_setting
        set
        attence_switch=#{attenceSwitch},
        stanger_switch=#{stangerSwitch},
        open_week_days=#{openWeekDays},
        day_begin_time=#{dayBeginTime},
        day_end_time=#{dayEndTime},
        gmt_modify = now(3)
        where
        switch_setting_id = #{switchSettingId}
        and org_id=#{orgId} and group_id=#{groupId}
    </update>

    <update id="updateSwitchSettingByGroupIdAndOrgId" parameterType="com.xier.sesame.attence.domain.NewSwitchSetting">
        update new_attence_switch_setting
        set
        <if test="attenceSwitch != null">
            attence_switch=#{attenceSwitch},
        </if>
        <if test="stangerSwitch != null">
            stanger_switch=#{stangerSwitch},
        </if>
        <if test="openWeekDays != null">
            open_week_days=#{openWeekDays},
        </if>
        <if test="dayBeginTime != null">
            day_begin_time=#{dayBeginTime},
        </if>
        <if test="dayEndTime != null">
            day_end_time=#{dayEndTime},
        </if>
        gmt_modify = now(3)
        where
        org_id=#{orgId} and group_id=#{groupId}
    </update>


    <update id="updateSwitchSettingSelective" parameterType="com.xier.sesame.attence.domain.NewSwitchSetting">
        update new_attence_switch_setting
        <set>
            <if test="attenceSwitch != null">
                attence_switch=#{attenceSwitch},
            </if>
            <if test="stangerSwitch != null">
                stanger_switch=#{stangerSwitch},
            </if>
            <if test="openWeekDays != null">
                open_week_days=#{openWeekDays},
            </if>
            <if test="dayBeginTime != null">
                day_begin_time=#{dayBeginTime},
            </if>
            <if test="dayEndTime != null">
                day_end_time=#{dayEndTime},
            </if>
            gmt_modify = now(3)
        </set>
        where
        switch_setting_id = #{switchSettingId}
        and org_id=#{orgId} and group_id=#{groupId}
    </update>

    <select id="getSwitchSettingById" parameterType="com.xier.sesame.attence.domain.NewSwitchSetting" resultMap="NewSwitchSettingResultMap">
        <include refid="sql_select"/>
        from new_attence_switch_setting
        where
        switch_setting_id = #{switchSettingId}
        and org_id=#{orgId} and group_id=#{groupId}
    </select>

    <select id="getSwitchSettingByIdForUpdate" parameterType="com.xier.sesame.attence.domain.NewSwitchSetting" resultMap="NewSwitchSettingResultMap">
        <include refid="sql_select"/>
        from new_attence_switch_setting
        where
        switch_setting_id = #{switchSettingId}
        and org_id=#{orgId} and group_id=#{groupId}
        for update
    </select>

    <delete id="removeSwitchSettingById" parameterType="com.xier.sesame.attence.domain.NewSwitchSetting">
        delete from new_attence_switch_setting
        where
        switch_setting_id = #{switchSettingId}
        and org_id=#{orgId} and group_id=#{groupId}
    </delete>

    <delete id="removeSwitchSettingByOrgIdAndGroupId" parameterType="com.xier.sesame.attence.domain.NewSwitchSetting">
        delete from new_attence_switch_setting
        where
        org_id=#{orgId} and group_id=#{groupId}
    </delete>


    <select id="getSwitchSettingListByOrgId" resultMap="NewSwitchSettingResultMap" parameterType="map" >
        <include refid="sql_select"/>
        from new_attence_switch_setting
        where org_id = #{orgId}
        order by gmt_modify desc
    </select>

    <select id="getPaginationSwitchSetting" resultMap="NewSwitchSettingResultMap" parameterType="map" >
        <include refid="sql_select"/>
        <include refid="sql_where"/>
        order by gmt_modify desc
        limit #{startRow}, #{pageSize}
    </select>

    <select id="getSwitchSettingCount" resultType="int" parameterType="com.xier.sesame.attence.domain.NewSwitchSetting" >
        select
        count(*)
        <include refid="sql_where"/>
    </select>



    <select id="getSwitchSettingByOrgId" parameterType="map" resultMap="NewSwitchSettingResultMap">
        <include refid="sql_select"/>
        from new_attence_switch_setting
        where
        org_id=#{orgId} and group_Id=#{groupId}
    </select>

    <select id="getDeviceBindingSwitchSettings" parameterType="map" resultMap="NewSwitchSettingResultMap">
        <include refid="sql_select"/>
        from new_attence_switch_setting
        where
        org_id=#{orgId}
        AND group_id in
        <foreach item="item" index="index" collection="groupIdList" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>




    <sql id="sql_where">
        from new_attence_switch_setting
        <where>
            <if test="switchSettingId != null">
                switch_setting_id = #{switchSettingId}
            </if>
            <if test="orgId != null">
                and org_id = #{orgId}
            </if>
            <if test="groupId != null">
                and group_id=#{groupId}
            </if>
            <if test="groupCode != null">
                and group_code=#{groupCode}
            </if>
            <if test="attenceSwitch != null">
                and attence_switch = #{attenceSwitch}
            </if>
            <if test="stangerSwitch != null">
                and stanger_switch = #{stangerSwitch}
            </if>
            <if test="openWeekDays != null">
                and open_week_days = #{openWeekDays}
            </if>
            <if test="dayBeginTime != null">
                and day_begin_time = #{dayBeginTime}
            </if>
            <if test="dayEndTime != null">
                and day_end_time = #{dayEndTime}
            </if>
        </where>
    </sql>

    <sql id="sql_select">
        select
        switch_setting_id,
        org_id,
        group_id,
        group_code,
        attence_switch,
        stanger_switch,
        open_week_days,
        day_begin_time,
        day_end_time,
        gmt_create,
        gmt_modify
    </sql>
</mapper>