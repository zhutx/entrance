<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" 
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.xier.sesame.attence.SubjectConfig">
			
	<resultMap id="subjectConfigResultMap" type="com.xier.sesame.attence.domain.SubjectConfig">
		<result column="subject_setting_id" property="subjectConfigId" />
		<result column="org_id" property="orgId" />
		<result column="device_id" property="deviceId" />
		<result column="subject_id" property="subjectId" />
		<result column="gmt_create" property="gmtCreate" />
		<result column="gmt_modify" property="gmtModify" />
	</resultMap>
	
	<select id="findDeviceIdBySubject" parameterType="map" resultType="long">
	    select device_id from attence_subject_setting where org_id=#{orgId} and subject_id = #{subjectId}
	</select>
	
	<delete id="deleteOne" parameterType="map">
 	    delete from attence_subject_setting
		where
		org_id = #{orgId}
		and subject_id = #{subjectId}
		and device_id=#{deviceId}
 	</delete>
	
	<insert id="addSubjectConfig" parameterType="com.xier.sesame.attence.domain.SubjectConfig">

		insert into attence_subject_setting(
			subject_setting_id,
			org_id,
			device_id,
			subject_id,
			gmt_create,
			gmt_modify	
		)
		values (
		 	#{subjectConfigId},
			#{orgId},
			#{deviceId},
			#{subjectId},
			now(3),
			now(3)
		)
	</insert>
	
	<select id="getSubjectId" parameterType="map" resultType="long">
        select subject_id 
		from attence_subject_setting
		where 
			org_id=#{orgId} and device_id = #{deviceId}
	</select>
	
	<delete id="deleteByDeviceId" parameterType="map">
		delete from attence_subject_setting
		where
		org_id = #{orgId}
		and device_id=#{deviceId}
 	</delete>
 	
 	<update id="updateSubjectId" parameterType="map">
 	    update 
 	        attence_subject_setting
 	    set 
 	        subject_id = #{subjectId}
 	    where 
 	        org_id = #{orgId} and 
 	        device_id = #{deviceId}
 	</update>
	
	<sql id="sql_where">
	    from attence_subject_setting
	    <where>
    	<if test="subjectConfigId != null">
		      subject_setting_id = #{subjectConfigId}
		</if>
		<if test="orgId != null">
		      and org_id = #{orgId}
		</if>
		<if test="deviceId != null">
		      and device_id = #{deviceId}
		</if>
		<if test="subjectId != null">
		      and subject_id = #{subjectId}
		</if>
		</where>
	</sql>  	
	
	<sql id="sql_select">
		select
			subject_setting_id,
			org_id,
			device_id,
			subject_id,
			gmt_create,
			gmt_modify	
	</sql>  
</mapper>